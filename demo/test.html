<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="jquery-1.10.2.min.js"></script>
    <link href="bootstrap.min.css" rel="stylesheet">
    <style>
        .red {
            background-color: red;
            color:#fff;
        }
        .Nofirstshow {
            display:none;
        }

    </style>

</head>
<body>
<table class="table table-bordered tableitem " id="table-120">
    <caption contenteditable="true" style="font-weight:bold;text-align:center;display:none">市委主要领导与部分村党支部书记座谈会意见建议研究落实情况表
    </caption>
    <thead></thead>
    <tbody>
    <tr data-itemid="402">
        <td style="width:2.1739130434782608%" colspan="1" rowspan="2" mapid="2708" vid="7191" class="trIndex"><input type="checkbox" class="trinput tri-402" value="402" data-depids="135,159" data-itemids="402" data-inputstates="1,1"><label class="suncheck checklabel" style="display:none"></label>1<span id="showNofirst">展开</span></span></td>
        <td class="Nofirstshow" style="width:6.521739130434782%" colspan="1" rowspan="2" mapid="2709" vid="7192">永宁街</td>
        <td class="Nofirstshow" style="width:6.521739130434782%" colspan="1" rowspan="2" mapid="2710" vid="7193">叶岭村</td>
        <td class="Nofirstshow" style="width:13.043478260869565%" colspan="1" rowspan="2" mapid="2711" vid="7194">加快完善新新公路路灯、绿化、标识、安全设施等配套设施,加紧完成。</td>
        <td class="Nofirstshow" style="width:8.695652173913043%" colspan="1" rowspan="2"><a class="deptset" data-inputtime="" data-inputer="" data-inputerphone="" data-operator="" data-operatorphone="" data-manager="" data-signer="" data-itemsid="120" data-departmentname="增城区教育局" data-departmentid="135" data-inputstate="1" data-retractstate="-1" data-retractcontent="" data-islock="0" data-isfrozen="0" data-itemid="402" data-itemcompletetime="2015-08-20 18:54:00" data-psneedupload="undefined" data-psneedcomplete="1" data-content="" data-adcreatedtime="" data-urgesendpeople="" data-itemdepid="737" data-psuploadtype="1" data-hasqtip="0">增城区教育局</a><br><a class="deptset" data-inputtime="" data-inputer="" data-inputerphone="" data-operator="" data-operatorphone="" data-manager="" data-signer="" data-itemsid="120" data-departmentname="增城区委综治办" data-departmentid="159" data-inputstate="1" data-retractstate="-1" data-retractcontent="" data-islock="0" data-isfrozen="0" data-itemid="402" data-itemcompletetime="2015-08-20 18:54:00" data-psneedupload="undefined" data-psneedcomplete="1" data-content="" data-adcreatedtime="" data-urgesendpeople="" data-itemdepid="738" data-psuploadtype="1" data-hasqtip="1">增城区委综治办</a><br></td>
        <td class="changecontent" style="width:17.391304347826086%" colspan="1" rowspan="1" mapid="2713" vid="7196" data-dmpsid="2069" data-pswordfloorlimit="1" data-pswordupperlimit="400"><a class="cfontnum" data-departmentid="135" data-valueid="7196" data-itemid="402" data-wordfloorlimit="" data-wordupperlimit="">增城区教育局:</a><br><span class="clickcontent">平时总是嘻嘻哈哈，什么都无所谓，可是转过头去,笑容里分明有几分无奈；电话那头千咛万嘱,回答的总是“我很好”“我没事”“放心吧”；一个人呆着，莫名其妙开始发呆，不知道想些什么,又好像什么都没想；总想找一个人倾诉,可是真有那么一个人时,却又不知从何说起；简单的我们有了很多复杂的情绪..</span></td>
        <td class="changecontent" style="width:13.043478260869565%" colspan="1" rowspan="1" mapid="2714" vid="7198" data-dmpsid="2070" data-pswordfloorlimit="1" data-pswordupperlimit="400"><a class="cfontnum" data-departmentid="135" data-valueid="7198" data-itemid="402" data-wordfloorlimit="" data-wordupperlimit="">增城区教育局:</a><br><span class="clickcontent">平时总是嘻嘻哈哈，什么都无所谓，可是转过头去,笑容里分明有几分无奈；电话那头千咛万嘱,回答的总是“我很好”“我没事”“放心吧”；一个人呆着，莫名其妙开始发呆，不知道想些什么,又好像什么都没想；总想找一个人倾诉,可是真有那么一个人时,却又不知从何说起；简单的我们有了很多复杂的情绪..</span></td>
    </tr>
    <tr data-itemid="402">
        <td class="changecontent" style="width:17.391304347826086%" colspan="1" rowspan="1" mapid="2713" vid="7197" data-dmpsid="2071" data-pswordfloorlimit="1" data-pswordupperlimit="400"><a class="cfontnum" data-departmentid="159" data-valueid="7197" data-itemid="402" data-wordfloorlimit="" data-wordupperlimit="">增城区委综治办:</a><br><span class="clickcontent">LOL佣兵大作战被玩坏：国外玩家利用兹若特传送门瞬拆水晶！国外玩家显然对这一模式并不感兴趣，于是各种奇葩的玩法也相继上演，今天我们来看一下美服这几位小伙伴是怎么玩的。</span></td>
        <td class="changecontent" style="width:13.043478260869565%" colspan="1" rowspan="1" mapid="2714" vid="7199" data-dmpsid="2072" data-pswordfloorlimit="1" data-pswordupperlimit="400"><a class="cfontnum" data-departmentid="159" data-valueid="7199" data-itemid="402" data-wordfloorlimit="" data-wordupperlimit="">增城区委综治办:</a><br><span class="clickcontent">LOL佣兵大作战被玩坏：国外玩家利用兹若特传送门瞬拆水晶！国外玩家显然对这一模式并不感兴趣，于是各种奇葩的玩法也相继上演，今天我们来看一下美服这几位小伙伴是怎么玩的。</span></td>
    </tr>
    <tr data-itemid="403">
        <td style="width:2.1739130434782608%" colspan="1" rowspan="1" mapid="2715" vid="7200" class="trIndex"><input type="checkbox" class="trinput tri-403" value="403" data-depids="12" data-itemids="403" data-inputstates="1"><label class="suncheck checklabel" style="display:none"></label>2</td>
        <td class="Nofirstshow" style="width:6.521739130434782%" colspan="1" rowspan="1" mapid="2716" vid="7201">永宁街</td>
        <td class="Nofirstshow" style="width:6.521739130434782%" colspan="1" rowspan="1" mapid="2717" vid="7202">叶岭村</td>
        <td class="Nofirstshow" style="width:13.043478260869565%" colspan="1" rowspan="1" mapid="2718" vid="7203">加快完善新新公路路灯、绿化、标识、安全设施等配套设施,加紧完成。</td>
        <td class="Nofirstshow" style="width:8.695652173913043%" colspan="1" rowspan="1"><a class="deptset" data-inputtime="" data-inputer="" data-inputerphone="" data-operator="" data-operatorphone="" data-manager="" data-signer="" data-itemsid="120" data-departmentname="开发区发展改革财政局" data-departmentid="12" data-inputstate="1" data-retractstate="-1" data-retractcontent="" data-islock="0" data-isfrozen="0" data-itemid="403" data-itemcompletetime="2015-08-20 18:54:00" data-psneedupload="undefined" data-content="" data-adcreatedtime="" data-urgesendpeople="" data-itemdepid="739" data-psuploadtype="1" data-hasqtip="2">开发区发展改革财政局</a><br></td>
        <td class="changecontent" style="width:8.695652173913043%" colspan="1" rowspan="1"><a class="deptset" data-inputtime="" data-inputer="" data-inputerphone="" data-operator="" data-operatorphone="" data-manager="" data-signer="" data-itemsid="120" data-departmentname="开发区发展改革财政局" data-departmentid="12" data-inputstate="1" data-retractstate="-1" data-retractcontent="" data-islock="0" data-isfrozen="0" data-itemid="403" data-itemcompletetime="2015-08-20 18:54:00" data-psneedupload="undefined" data-content="" data-adcreatedtime="" data-urgesendpeople="" data-itemdepid="739" data-psuploadtype="1" data-hasqtip="2">开发区发展改革财政局</a><br><span class="clickcontent">由彭顺执导，@王珞丹 @周渝民 领衔主演的小妞侦探电影《宅女侦探桂香》发布终极预告！失恋侦探桂香追查失踪渣前任，帅气警官阿哲卷入连环碎尸案。各色人等轮番登场，#813宅女侦探桂香# 一起捉拿真凶！ 女人天生是侦探，坐等桂香侦破真相！可是看着仔仔的脸还能好好破案吗</span></td>
        <td class="changecontent" style="width:8.695652173913043%" colspan="1" rowspan="1"><a class="deptset" data-inputtime="" data-inputer="" data-inputerphone="" data-operator="" data-operatorphone="" data-manager="" data-signer="" data-itemsid="120" data-departmentname="开发区发展改革财政局" data-departmentid="12" data-inputstate="1" data-retractstate="-1" data-retractcontent="" data-islock="0" data-isfrozen="0" data-itemid="403" data-itemcompletetime="2015-08-20 18:54:00" data-psneedupload="undefined" data-content="" data-adcreatedtime="" data-urgesendpeople="" data-itemdepid="739" data-psuploadtype="1" data-hasqtip="2">开发区发展改革财政局</a><br><span class="clickcontent">由彭顺执导，@王珞丹 @周渝民 领衔主演的小妞侦探电影《宅女侦探桂香》发布终极预告！失恋侦探桂香追查失踪渣前任，帅气警官阿哲卷入连环碎尸案。各色人等轮番登场，#813宅女侦探桂香# 一起捉拿真凶！ 女人天生是侦探，坐等桂香侦破真相！可是看着仔仔的脸还能好好破案吗</span></td>
    </tr>
    </tbody>
</table>
<button class="btn btn-success">提交</button>
<div id="content"></div>
<script>
//    $(function(){
//        var i = 0;
//        var startflag = 0;
//        var endflag = 0;
//        $(".clickcontent").mouseup(function(e){
//            alert($(this).html());
//            if(window.getSelection) {
//                var textObj = $(this).html();
//                var selectedText = window.getSelection().toString();
//                selectedText = selectedText.replace("<span class='red'>","")
//                selectedText = selectedText.replace("</span>","")
//                selectedText = "<span class='red'>"+selectedText+"</span>";
//
//                var start = window.getSelection().anchorOffset;
//                var end = window.getSelection().focusOffset;
//
//                console.log("start:"+start+";end:"+end)
//
//                var tempStr1 = textObj.substring(0,start);
//                var tempStr2 = textObj.substring(end);
//
//                $(this).html(tempStr1 + selectedText + tempStr2)
//                i++
//            }
//        });
//    });

    $(function(){
//        var text = $(".clickcontent").html()
//        text = text.replace(/(\。|\；|、|，)/g,"$1</span><span class='soncontent'>")
//        text = "<span class='soncontent'>" + text
//        text = text.slice(0,length-6)
//        $(".clickcontent").html(text)
//        $('.soncontent').on('click',function(){
//            $(this).toggleClass("red")
//        })
        $("#showNofirst").on("click",function(){
            if($(this).html()=="展开"){
                $(this).html("收起");
                $(".Nofirstshow").show();
            }else{
                $(this).html("展开");
                $(".Nofirstshow").hide();
            }
        })
        var obj = $(".clickcontent")
        for(var i = 0;i<obj.length;i++){
            text = obj[i].innerHTML
            text = text.replace(/(\。|\；|、|，|：|！|？)/g,"$1</span><span class='soncontent'>")
            text = "<span class='soncontent'>" + text
            obj[i].innerHTML = text
        }
        $('.soncontent').on('click',function(){
            $(this).toggleClass("red")
        })
        $(".btn").on("click",function(){
            var text = ""

            for(var i = 0;i<$("tbody>tr").length;i++){
                text = text + ($("tbody>tr")[i].attributes["data-itemid"].value) + ":";
                var sonobj = $("tbody>tr")[i].getElementsByClassName("changecontent");
                for(var j = 0;j<sonobj.length;j++){
                    //alert(sonobj.getElementsByClassName("clickcontent").length)
                    text = text + "("+ j +")"
                    var grandobj=sonobj[j].getElementsByClassName("red")
                    for(var x = 0;x<grandobj.length;x++){
                        text = text + grandobj[x].innerHTML
                    }
                }
                text = text + "\n"
            }
            console.log(text)
        })
    })
</script>
</body>
</html>
